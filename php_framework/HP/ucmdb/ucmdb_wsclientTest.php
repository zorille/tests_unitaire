<?php
namespace Zorille\framework;
use \Exception as Exception;
if (! defined ( '__DOCUMENT_ROOT__' )) {
	require_once $_SERVER ["PWD"] . '/prepare.php';
}

/**
 * Generated by PHPUnit_SkeletonGenerator 1.2.1 on 2014-08-25 at 16:53:15.
 */
class ucmdb_wsclientTest extends MockedListeOptions {
	/**
	 *
	 * @var ucmdb_wsclient
	 */
	protected $object;

	/**
	 * Sets up the fixture, for example, opens a network connection. This method is called before a test is executed.
	 */
	protected function setUp() {
		ob_start ();
		
		$gestion_connexion_url = $this ->createMock('Zorille\framework\gestion_connexion_url' );
		$ucmdb_datas = $this ->createMock('Zorille\framework\ucmdb_datas' );
		$soap = $this ->createMock('Zorille\framework\soap' );
		
		$this->object = new ucmdb_wsclient ( false, "TESTS ucmdb_wsclient" );
		$this->object ->setListeOptions ( $this ->getListeOption () ) 
			->setObjetUcmdbDatas ( $ucmdb_datas ) 
			->setObjetSoap ( $soap );
	}

	/**
	 * Tears down the fixture, for example, closes a network connection. This method is called after a test is executed.
	 */
	protected function tearDown() {
		ob_end_clean ();
	}

	/**
	 * @covers Zorille\framework\ucmdb_wsclient::prepare_connexion
	 */
	public function testPrepare_connexion_exception1() {
		$this->object ->getListeOptions () 
			->method ( 'getOption' ) 
			->will ( $this ->returnValue ( false ) );
		
		$this->object ->getObjetUcmdbDatas () 
			->method ( 'valide_presence_ucmdb_data' ) 
			->will ( $this ->returnValue ( false ) );
		$this->object ->getObjetUcmdbDatas () 
			->expects ( $this ->any () ) 
			->method ( 'recupere_donnees_ucmdb_serveur' ) 
			->will ( $this ->returnValue ( array () ) );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'setCacheWsdl' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'retrouve_variables_tableau' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'connect' ) 
			->will ( $this ->returnSelf () );
		
		$this ->expectException(Exception::class);
        $this->expectExceptionMessage( '(TESTS ucmdb_wsclient) Aucune definition de ucmdb pour NOM1' );
		$this->object ->prepare_connexion ( "NOM1" );
	}

	/**
	 * @covers Zorille\framework\ucmdb_wsclient::prepare_connexion
	 */
	public function testPrepare_connexion_exception2() {
		$this->object ->getListeOptions () 
			->method ( 'getOption' ) 
			->will ( $this ->returnValue ( false ) );
		
		$this->object ->getObjetUcmdbDatas () 
			->method ( 'valide_presence_ucmdb_data' ) 
			->will ( $this ->returnValue ( array () ) );
		$this->object ->getObjetUcmdbDatas () 
			->expects ( $this ->any () ) 
			->method ( 'recupere_donnees_ucmdb_serveur' ) 
			->will ( $this ->returnValue ( array () ) );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'setCacheWsdl' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'retrouve_variables_tableau' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'connect' ) 
			->will ( $this ->returnSelf () );
		
		$this ->expectException(Exception::class);
        $this->expectExceptionMessage( '(TESTS ucmdb_wsclient) Il faut un username dans la liste des parametres ucmdb' );
		$this->object ->prepare_connexion ( "NOM1" );
	}

	/**
	 * @covers Zorille\framework\ucmdb_wsclient::prepare_connexion
	 */
	public function testPrepare_connexion_exception3() {
		$this->object ->getListeOptions () 
			->method ( 'getOption' ) 
			->will ( $this ->returnValue ( false ) );
		
		$this->object ->getObjetUcmdbDatas () 
			->method ( 'valide_presence_ucmdb_data' ) 
			->will ( $this ->onConsecutiveCalls ( array ( 
				"username" => "user" ) ) );
		$this->object ->getObjetUcmdbDatas () 
			->expects ( $this ->any () ) 
			->method ( 'recupere_donnees_ucmdb_serveur' ) 
			->will ( $this ->returnValue ( array () ) );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'setCacheWsdl' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'retrouve_variables_tableau' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'connect' ) 
			->will ( $this ->returnSelf () );
		
		$this ->expectException(Exception::class);
        $this->expectExceptionMessage( '(TESTS ucmdb_wsclient) Il faut un password dans la liste des parametres ucmdb' );
		$this->object ->prepare_connexion ( "NOM1" );
	}

	/**
	 * @covers Zorille\framework\ucmdb_wsclient::prepare_connexion
	 */
	public function testPrepare_connexion_exception4() {
		$this->object ->getListeOptions () 
			->method ( 'getOption' ) 
			->will ( $this ->returnValue ( false ) );
		
		$this->object ->getObjetUcmdbDatas () 
			->method ( 'valide_presence_ucmdb_data' ) 
			->will ( $this ->returnValue ( array ( 
				"username" => "user", 
				"password" => "pwd" ) ) );
		$this->object ->getObjetUcmdbDatas () 
			->expects ( $this ->any () ) 
			->method ( 'recupere_donnees_ucmdb_serveur' ) 
			->will ( $this ->returnValue ( array () ) );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'setCacheWsdl' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'retrouve_variables_tableau' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'connect' ) 
			->will ( $this ->returnSelf () );
		
		$this ->expectException(Exception::class);
        $this->expectExceptionMessage( '(TESTS ucmdb_wsclient) Il faut une url dans la liste des parametres ucmdb' );
		$this->object ->prepare_connexion ( "NOM1" );
	}

	/**
	 * @covers Zorille\framework\ucmdb_wsclient::prepare_connexion
	 */
	public function testPrepare_connexion_valide() {
		$this->object ->getListeOptions () 
			->method ( 'getOption' ) 
			->will ( $this ->returnValue ( false ) );
		
		$this->object ->getObjetUcmdbDatas () 
			->method ( 'valide_presence_ucmdb_data' ) 
			->will ( $this ->returnValue ( array ( 
				"username" => "user", 
				"password" => "pwd", 
				"url" => "URL1" ) ) );
		$this->object ->getObjetUcmdbDatas () 
			->expects ( $this ->any () ) 
			->method ( 'recupere_donnees_ucmdb_serveur' ) 
			->will ( $this ->returnValue ( array () ) );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'setCacheWsdl' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'retrouve_variables_tableau' ) 
			->will ( $this ->returnSelf () );
		$this->object ->getObjetSoap () 
			->expects ( $this ->any () ) 
			->method ( 'connect' ) 
			->will ( $this ->returnSelf () );
		
		$this ->assertSame ( $this->object, $this->object ->prepare_connexion ( "NOM1" ) );
	}
}
